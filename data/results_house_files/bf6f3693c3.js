(function(){window.pageBuilder=window.pageBuilder||{};window.pageBuilder.featureLoaded=function(){};window.pageBuilder.loadAsyncFeatures=function(){var d=window.document,featuresLoaded=[];var url=window._context+"/api/v2/async/features?rid\x3d"+window._rid+"\x26contentUri\x3d"+window._uri+"\x26outputType\x3d"+window._outputType+(window.wp_meta_data.isPremium&&window.wp_meta_data.isPremium===true?"\x26premium\x3dtrue":"")+getCleanParams();window.pageBuilder._getJson(url,function(resp){injectAsyncFeatures(resp)});
function getCleanParams(params){params=params||location.search;if(params){params=params.split("?")[1];["rid","contentUri","outputType","dehydrate","pwa","utm_term"].forEach(function(key){var re=new RegExp("(^|\x26)"+key+"\x3d[^\x26]+","g");params=params.replace(re,"")});params="\x26"+params}return params}function injectAsyncFeatures(apiResp){var reducedResponse=getReducedResponse(),fidsInDomOrder=getFidsInDomOrder(),strategy="slow-and-sparkling";injectResources({loc:"before",fids:fidsInDomOrder,strategy:strategy}).then(function(){injectRenderings({fids:fidsInDomOrder}).then(function(){injectResources({loc:"after",
fids:fidsInDomOrder,strategy:strategy}).then(function(){featuresLoaded.forEach(function(element){window.pageBuilder.featureLoaded(element)});$(d).trigger("dom-manipulation-complete").trigger("async-features-loaded");document.dispatchEvent(new CustomEvent("async-features-loaded"))})})});function getFidsInDomOrder(){return[].filter.call(document.querySelectorAll("[id].pb-async.pb-feature"),function(){return true}).map(function(node){return node.id})}function getReducedResponse(){var resp={};for(var fid in apiResp){var featureResp=
apiResp[fid],resources={before:{},after:{}};window.pbHeadResourceGroups.forEach(function(group){resources.before=getResourcesByGroup(group,featureResp,resources.before)});window.pbTwpGlobalResourceGroups.forEach(function(group){resources.before=getResourcesByGroup(group,featureResp,resources.before)});window.pbFootResourceGroups.forEach(function(group){resources.after=getResourcesByGroup(group,featureResp,resources.after)});var featureType=null;if(featureResp.rendering.match(/.*?data-feature-id="([^"]+)"/))featureType=
RegExp.$1;resp[fid]={featureType:featureType,isFeatureIdInDom:!!d.getElementById(fid),rendering:featureResp.rendering,resources:resources,processed:{before:false,rendering:false,after:false}}}return resp}function injectResources(options){options=options||{};options.fids=options.fids||[];options.loc=options.loc||"no-location-specified";options.strategy=options.strategy||"slow-and-sparkling";var fragment=document.createDocumentFragment(),resourcesToAdd=[],stylesToAdd=[],scriptsToAdd=[];options.fids.forEach(function(fid){if(reducedResponse.hasOwnProperty(fid))if(!reducedResponse[fid].processed[options.loc]){reducedResponse[fid].processed[options.loc]=
true;for(var resourceType in reducedResponse[fid].resources[options.loc])reducedResponse[fid].resources[options.loc][resourceType].forEach(function(resource){if(options.strategy=="slow-and-sparkling"){if(resource.indexOf("style.css")===-1||resource.indexOf("style.css")>=0&&(location.toString().indexOf("_compact\x3dfalse")>=0||location.toString().indexOf("//local")>=0))if(resourcesToAdd.indexOf(resource)===-1)resourcesToAdd.push(resource)}else if(resourceType=="css"&&resource.indexOf("style.css")===
-1){if(stylesToAdd.indexOf(resource)===-1)stylesToAdd.push(resource)}else if(resourceType=="js")if(scriptsToAdd.indexOf(resource)===-1)scriptsToAdd.push(resource)})}});if(options.strategy=="slow-and-sparkling")return window.wp_import(resourcesToAdd);else{fragment=document.createDocumentFragment();stylesToAdd.forEach(function(resource){var e=d.createElement("link");e.setAttribute("rel","stylesheet");e.setAttribute("type","text/css");e.setAttribute("href",resource);fragment.appendChild(e)});scriptsToAdd.forEach(function(resource){var e=
d.createElement("script");e.setAttribute("type","text/javascript");e.setAttribute("src",resource);fragment.appendChild(e)});d.body.appendChild(fragment);return Promise.resolve("Success")}}function injectRenderings(options){options=options||{};options.fids=options.fids||[];options.fids.forEach(function(fid){if(reducedResponse.hasOwnProperty(fid))if(!reducedResponse[fid].processed.rendering){reducedResponse[fid].processed.rendering=true;var element=d.getElementById(fid);if(!document.createRange&&!!document.createRange&&
!!document.createRange().createContextualFragment){var range=document.createRange();var fragment=range.createContextualFragment(reducedResponse[fid].rendering);element.parentNode.replaceChild(fragment,element);element=d.getElementById(fid)}else{element.outerHTML=reducedResponse[fid].rendering;element=d.getElementById(fid);var scripts=Array.prototype.slice.call(element.getElementsByTagName("script"));for(var i=0;i<scripts.length;i++)if(scripts[i].src!=""){var s=d.createElement("script");s.setAttribute("src",
scripts[i].src);d.body.appendChild(s)}else if(!scripts[i].getAttribute("type")||!!scripts[i].getAttribute("type").match(/(text|application)\/javascript/))try{window.pageBuilder._executeAsyncFeatureScripts(scripts[i].innerHTML)}catch(e){}}featuresLoaded.push(element)}});return Promise.resolve("Success")}function getResourcesByGroup(group,featureResp,resourcesToAdd){resourcesToAdd=resourcesToAdd||{};if(featureResp.hasOwnProperty(group.resourceType)&&featureResp[group.resourceType].hasOwnProperty(group.name)&&
!!featureResp[group.resourceType][group.name].length)if(group.resourceType=="externalResources")featureResp[group.resourceType][group.name].forEach(function(resource){if(window.pbExternalResourcesLoaded.indexOf(resource)===-1){if(!resourcesToAdd.hasOwnProperty(group.fileType))resourcesToAdd[group.fileType]=[];if(resourcesToAdd[group.fileType].indexOf(resource)===-1)resourcesToAdd[group.fileType].push(resource)}});else if(group.resourceType=="pageResources")featureResp[group.resourceType][group.name].forEach(function(resource){if(featureResp.rendering.match(/.*?data-feature-id="([^"]+)"/)){var featureType=
RegExp.$1;if(![].filter.call(document.querySelectorAll('[data-feature-id\x3d"'+featureType+'"]'),function(node){return!$(node).closest(".pb-feature").length}).length){if(!resourcesToAdd.hasOwnProperty(group.fileType))resourcesToAdd[group.fileType]=[];if(resourcesToAdd[group.fileType].indexOf(resource)===-1)resourcesToAdd[group.fileType].push(resource)}}});return resourcesToAdd}}}})();