(function(){__e=window.__e||[];var wp_pb=window.wp_pb||{};var heliodeck=window.heliodeck||{PAGESIZE:10,colorList:{republican:"red",democrat:"blue"},omnitureEvars:{open_default:"helio_dflt_open",open_click:"helio_user_open",closed_click:"helio_close",open:"heliodeck_open_continued"},system_state:"running",polling_state:"running",pollingUrl:null,pagingUrl:null,deckInterval:null,init:function(){heliodeck.deckWrapper=document.getElementById("heliodeck_wrapper");heliodeck.deckCounter=document.getElementById("heliodeck_counter");
heliodeck.deckContainer=document.getElementById("heliodeck_container");heliodeck.deckStatements=document.getElementById("heliodeck_statements");heliodeck.loadOlder=document.getElementById("heliodeck_load_more");var jewel=document.getElementById("heliodeck_jewel"),close=document.getElementById("heliodeck_close");if(heliodeck.deckWrapper){heliodeck.POLLINGINTERVAL=parseInt(heliodeck.deckWrapper.getAttribute("data-pollinginterval"))||3E4,heliodeck.POLLINGINTERVAL_ERROR=parseInt(heliodeck.deckWrapper.getAttribute("data-pollingintervalerror"))||
12E4,heliodeck.MAXCOUNT=parseInt(heliodeck.deckWrapper.getAttribute("data-maxcount"))||9,heliodeck.MAXCOUNTSTRING=heliodeck.MAXCOUNT+"+";var shouldWelcome=false,listStatus="closed",statusEvent="";if(wp_pb.StaticMethods&&wp_pb.StaticMethods.isLocalStorageAccessible()){var welcomed=localStorage.getItem("heliodeck_welcome");var lsStatus=localStorage.getItem("heliodeck_list_status");if(!welcomed){shouldWelcome=true;localStorage.setItem("heliodeck_welcome",true)}if(wp_pb&&wp_pb.BrowserInfo.mobile){listStatus=
"closed";window.googletag&&window.googletag.pubads&&window.googletag.pubads().addEventListener("slotRenderEnded",function(t){var n=t.slot.getSlotElementId();if(n==="slug_fixedBottom"){var o=document.getElementById(n);if(o)heliodeck.deckWrapper.setAttribute("style","bottom: "+o.clientHeight+"px;")}});heliodeck.checkBottom();window.addEventListener("resize",function(){wp_pb.StaticMethods.debounce(heliodeck.resizeContainer(),500)})}else if(!lsStatus){listStatus="open";statusEvent="default"}else if(lsStatus&&
lsStatus=="open")listStatus="open"}else{shouldWelcome=true;listStatus="closed"}jewel.addEventListener("click",function(){var status;if(heliodeck.deckWrapper.className.indexOf("open")>=0)status="closed";else status="open";heliodeck.setStatus(status,"click")});heliodeck.loadOlder.addEventListener("click",heliodeck.handleLoadOlder);heliodeck.deckContainer.addEventListener("scroll",wp_pb.StaticMethods.debounce(function(e){heliodeck.manageParentScrolling(e);if(heliodeck.isScrolledToBottom())if(heliodeck.deckWrapper.className.indexOf("open")>=
0){heliodeck.deckCounter.innerText="";heliodeck.deckCounter.className=" empty"}},20),true);heliodeck.deckContainer.addEventListener("wheel",heliodeck.manageParentScrolling);heliodeck.deckContainer.addEventListener("touchmove",heliodeck.manageParentScrolling);heliodeck.deckContainer.addEventListener("touchstart",heliodeck.manageParentScrolling);close.addEventListener("click",function(){heliodeck.setStatus("closed","click")});wp_pb.StaticMethods.reactOnPageVisibilityChanges(function(){heliodeck.pollForStatements("restart")},
function(){heliodeck.pollForStatements("stop")});this.getInitialCursor(heliodeck.deckWrapper,listStatus,statusEvent,shouldWelcome)}},getInitialCursor:function(deckWrapper,listStatus,eventStatus,shouldWelcome){shouldWelcome=shouldWelcome||false;var cursorPath=deckWrapper.getAttribute("data-cursor"),isMoreFiles=false;if(cursorPath)heliodeck.makeApiCall(cursorPath).then(function(responseJson){var system_state=!responseJson.system_state?"running":responseJson.system_state;heliodeck.system_state=system_state;
if(system_state!="running")throw{status:"state_change",system_state:system_state};var fileArray=[],totalCount=0;for(var i=0;i<responseJson.recent_published_files.length;i++){var currFile=responseJson.recent_published_files[i];if(currFile&&currFile.statements_included>0&&currFile.s3_path!=responseJson.last_file){fileArray.unshift(currFile.s3_path);heliodeck.deckStatements.className="";totalCount+=currFile.statements_included}if(totalCount>=5){if(responseJson.recent_published_files[i+1])heliodeck.pagingUrl=
responseJson.recent_published_files[i+1].s3_path;else heliodeck.pagingUrl=responseJson.recent_published_files[i].s3_path;isMoreFiles=i<responseJson.recent_published_files.length;break}}fileArray.push(responseJson.last_file);heliodeck.pollingUrl=responseJson.last_file;heliodeck.loadArray(fileArray).then(function(loadResponse){heliodeck.processStatements(loadResponse.statements,true)}).then(function(){if(shouldWelcome){var welcomeStatement=heliodeck.deckWrapper.getAttribute("data-welcome");if(welcomeStatement)heliodeck.processStatements([{uuid:1,
statement:welcomeStatement,classes:"welcome"}],true)}if(isMoreFiles)heliodeck.loadOlder.className="more";heliodeck.setStatus(listStatus,eventStatus);heliodeck.setStyles();heliodeck.pollForStatements("start")})})["catch"](function(response){if(response.system_state=="stopped"||response.system_state=="kill")heliodeck.shutDownWidget(response.system_state)})},loadArray:function(fileArray){var statementCount=0,statementArray=[];var arrayPromise=fileArray.map(heliodeck.makeApiCall).reduce(function(sequence,
filePromise){return sequence.then(function(){return filePromise}).then(function(responseJson){statementCount+=responseJson.statements.length;statementArray=statementArray.concat(responseJson.statements.reverse())})},Promise.resolve());return arrayPromise.then(function(){return Promise.resolve({statement_count:statementCount,statements:statementArray})})},manageParentScrolling:function(e){if(e.type==="touchstart")heliodeck.touchPrev=e.pageY;if(e.type==="touchmove"){var touchCurr=e.pageY,delta=touchCurr-
heliodeck.touchPrev;heliodeck.touchPrev=touchCurr;if(heliodeck.deckContainer.scrollHeight-heliodeck.deckContainer.clientHeight===heliodeck.deckContainer.scrollTop&&delta<=0||heliodeck.deckContainer.scrollTop===0&&delta>=0)e.preventDefault()}if(e.type==="wheel"){var deltaY=parseInt(e.deltaY,10)||0;var offsetTop=heliodeck.deckContainer.scrollTop+deltaY;var offsetBottom=heliodeck.deckContainer.scrollHeight-heliodeck.deckContainer.clientHeight-offsetTop;if(heliodeck.deckContainer.scrollTop===0&&offsetTop<
0||heliodeck.deckContainer.scrollHeight-heliodeck.deckContainer.scrollTop<=heliodeck.deckContainer.clientHeight&&offsetBottom<=0)e.preventDefault();else e.stopImmediatePropagation()}},setStatus:function(status,userEvent){heliodeck.deckWrapper.className=status;wp_pb.StaticMethods.isLocalStorageAccessible()&&localStorage.setItem("heliodeck_list_status",status);heliodeck.deckCounter.innerText="";heliodeck.deckCounter.className=" empty";if(status=="open"){heliodeck.deckContainer.scrollTop=heliodeck.deckStatements.scrollHeight;
heliodeck.resizeContainer()}if(userEvent){var eventLookup=status+(userEvent?"_"+userEvent:"");heliodeck.sendOmnitureEvent(status,"event80",{eVar26:heliodeck.omnitureEvars[eventLookup]})}},resizeContainer:function(){heliodeck.deckContainer.removeAttribute("style");var containerH=360,newH=0,headerH=document.getElementById("wp-header").clientHeight;if(window.innerHeight<heliodeck.deckWrapper.scrollHeight){newH=containerH-Math.abs(heliodeck.deckWrapper.offsetTop)-headerH;heliodeck.deckContainer.setAttribute("style",
"height:"+newH+"px;")}heliodeck.checkBottom()},checkBottom:function(){var sfb=document.getElementById("slug_fixedBottom");heliodeck.deckWrapper.removeAttribute("style");if(sfb&&sfb.clientHeight>50)heliodeck.deckWrapper.setAttribute("style","bottom: "+sfb.clientHeight+"px;")},shutDownWidget:function(system_state){clearInterval(heliodeck.deckInterval);heliodeck.deckInterval=null;heliodeck.deckWrapper.className=system_state},isScrolledToBottom:function(){return heliodeck.deckContainer.scrollHeight-heliodeck.deckContainer.scrollTop===
heliodeck.deckContainer.clientHeight},setStyles:function(){if(heliodeck.deckStatements.clientHeight<heliodeck.deckContainer.clientHeight){var stTop=heliodeck.deckContainer.clientHeight-heliodeck.deckStatements.scrollHeight;heliodeck.deckStatements.setAttribute("style","top:"+stTop+"px;")}else if(heliodeck.deckStatements.getAttribute("style"))heliodeck.deckStatements.removeAttribute("style")},sendOmnitureEvent:function(link,event,trackingProps){trackingProps=trackingProps||{};if(window.s&&s.sendDataToOmniture){trackingProps.pagename=
s.pageName;trackingProps.channel=s.channel;trackingProps.eVar1=s.eVar1;trackingProps.eVar2=s.eVar2;s.sendDataToOmniture(link,event,trackingProps)}},handleLoadOlder:function(){heliodeck.currHeight=heliodeck.deckContainer.scrollHeight;heliodeck.loadOlderStatements()},loadOlderStatements:function(loadResponse){loadResponse=loadResponse||{};loadResponse.statements=loadResponse.statements||[];var totalCount=loadResponse.totalCount||0;if(heliodeck.pagingUrl){heliodeck.loadOlder.className="loading";heliodeck.loadOlder.removeEventListener("click",
heliodeck.handleLoadOlder);heliodeck.makeApiCall(heliodeck.pagingUrl).then(function(responseJson){heliodeck.pagingUrl=responseJson.previous_s3_path;totalCount+=responseJson.statements.length;loadResponse.totalCount=totalCount;loadResponse.statements=responseJson.statements.reverse().concat(loadResponse.statements);if(heliodeck.pagingUrl&&totalCount<heliodeck.PAGESIZE)heliodeck.loadOlderStatements(loadResponse);else heliodeck.processStatements(loadResponse.statements,true,true).then(function(fragment){if(fragment)heliodeck.deckStatements.insertBefore(fragment,
heliodeck.deckStatements.children[1]);if(!heliodeck.pagingUrl)heliodeck.loadOlder.remove();else{heliodeck.loadOlder.className="more";heliodeck.loadOlder.addEventListener("click",heliodeck.handleLoadOlder)}heliodeck.deckContainer.scrollTop=heliodeck.deckContainer.scrollHeight-heliodeck.currHeight})})["catch"](function(){heliodeck.processStatements(loadResponse.statements,true,true).then(function(fragment){if(!heliodeck.pagingUrl)heliodeck.loadOlder.remove();else{if(fragment)heliodeck.deckStatements.insertBefore(fragment,
heliodeck.deckStatements.children[1]);heliodeck.deckContainer.scrollTop=heliodeck.deckContainer.scrollHeight-heliodeck.currHeight;heliodeck.loadOlder.className="more";heliodeck.loadOlder.addEventListener("click",heliodeck.handleLoadOlder)}})})}},pollForStatements:function(pollStatus,pollInterval){pollInterval=!pollInterval?heliodeck.POLLINGINTERVAL:pollInterval;if(heliodeck.system_state=="running")if(pollStatus=="restart")heliodeck.polling("restart");else if(pollStatus=="start")heliodeck.deckInterval=
setInterval(heliodeck.polling,pollInterval);else if(pollStatus=="stop"){clearInterval(heliodeck.deckInterval);heliodeck.deckInterval=null}},polling:function(pollStatus,loadResponse){loadResponse=loadResponse||{};loadResponse.statements=loadResponse.statements||[];heliodeck.makeApiCall(heliodeck.pollingUrl).then(function(responseJson){heliodeck.removeStatements(responseJson.unpublished);loadResponse.statements=loadResponse.statements.concat(responseJson.statements.reverse());heliodeck.pollingUrl=responseJson.next_s3_path?
responseJson.next_s3_path:responseJson.s3_path;var system_state=!responseJson.system_state?"running":responseJson.system_state;heliodeck.system_state=system_state;if(heliodeck.system_state!="running")throw{status:"state_change",system_state:heliodeck.system_state};if(responseJson.next_s3_path)heliodeck.polling(pollStatus,loadResponse);else{heliodeck.processStatements(loadResponse.statements).then(heliodeck.setStyles);if(pollStatus==="restart")heliodeck.pollForStatements("start");else if(heliodeck.polling_state!=
"running"){heliodeck.polling_state="running";clearInterval(heliodeck.deckInterval);heliodeck.deckInterval=null;heliodeck.pollForStatements("start")}}})["catch"](function(response){heliodeck.processStatements(loadResponse.statements).then(heliodeck.setStyles);if(response.system_state=="stopped"){clearInterval(heliodeck.deckInterval);heliodeck.deckInterval=null}else if(response.system_state=="kill")heliodeck.shutDownWidget(response.system_state);else if(response.status==="error")if(heliodeck.polling_state==
"running"){heliodeck.polling_state="error";clearInterval(heliodeck.deckInterval);heliodeck.deckInterval=null;heliodeck.pollForStatements("start",heliodeck.POLLINGINTERVAL_ERROR)}else;else if(response.status==="timeout");})},buildStatementHtml:function(currStatement){var statementElem=document.createElement("div");statementElem.className="heliodeck-statement";statementElem.id=currStatement.uuid;var tags=currStatement.tags||[];for(var t=0;t<tags.length;t++){var colorTag=heliodeck.colorList[tags[t].toLowerCase()];
statementElem.className+=colorTag?" "+colorTag:""}if(currStatement.classes)statementElem.className+=" "+currStatement.classes;statementElem.innerHTML=currStatement.statement;if(currStatement.time_published){var pub=moment(currStatement.time_published);var newElem=document.createElement("span");newElem.className="heliodeck-statement-time";newElem.setAttribute("data-time",pub);newElem.appendChild(document.createTextNode(pub.format("h:mm A")));statementElem.appendChild(newElem)}var hrefs=statementElem.getElementsByTagName("a");
for(var i=0;i<hrefs.length;i++){var thisHref=hrefs[i].href;if(thisHref.match(/(.washingtonpost.com\/|.digitalink.com\/)/gi)){var qsDelim=thisHref.indexOf("?")>0?"\x26":"?";thisHref+=qsDelim+"tid\x3dhldk"}hrefs[i].setAttribute("target","_blank");hrefs[i].href=thisHref}return statementElem},addStatement:function(currStatement,isLoadOlder,fragment){isLoadOlder=isLoadOlder||false;fragment=fragment&&isLoadOlder?fragment:heliodeck.deckStatements;try{var isEdited=currStatement.edited,existingStatement=document.getElementById(currStatement.uuid),
isDuplicate=existingStatement?true:false,shouldUpdateCount=false,shouldScrollToBottom=false;if(!isDuplicate){var newStatementElem=heliodeck.buildStatementHtml(currStatement);if(heliodeck.isScrolledToBottom())shouldScrollToBottom=true;if(heliodeck.deckWrapper.className.indexOf("closed")>=0||!shouldScrollToBottom)shouldUpdateCount=true;if(isLoadOlder){shouldUpdateCount=false;newStatementElem.className+=" older";if(!fragment.children)fragment.appendChild(newStatementElem);else fragment.insertBefore(newStatementElem,
fragment.children[0])}else{newStatementElem.className+=" new";fragment.appendChild(newStatementElem)}}else if(isDuplicate&&isEdited){var existingStatementElem=heliodeck.buildStatementHtml(currStatement);existingStatementElem.className+=" edited";existingStatement.replaceWith(existingStatementElem)}if(shouldUpdateCount)if(heliodeck.deckCounter.innerText==heliodeck.MAXCOUNTSTRING);else{var count=0;try{count=parseInt(heliodeck.deckCounter.innerText)||0}catch(err){}count+=1;if(count>=heliodeck.MAXCOUNT)heliodeck.deckCounter.innerText=
heliodeck.MAXCOUNTSTRING;else heliodeck.deckCounter.innerText=count;if(count==1&&heliodeck.deckCounter.className.indexOf("empty")>=0)heliodeck.deckCounter.className=heliodeck.deckCounter.className.replace("empty","")}if(shouldScrollToBottom)heliodeck.deckContainer.scrollTop=heliodeck.deckStatements.scrollHeight;if(heliodeck.deckStatements.className)heliodeck.deckStatements.className=""}catch(err){}},processStatements:function(statements,isImmediate,isLoadOlder){isImmediate=isImmediate||false;if(isLoadOlder)statements.reverse();
return new Promise(function(resolve,reject){if(statements.length===0)resolve();try{var fragment=null;if(isLoadOlder)fragment=document.createDocumentFragment();if(isImmediate){for(var i=0;i<statements.length;i++)heliodeck.addStatement(statements[i],isLoadOlder,fragment);resolve(fragment)}else addCurrStatements(statements,isLoadOlder,fragment)}catch(err){reject()}function addCurrStatements(statements,isLoadOlder,fragment){var currStatement=statements.shift();if(currStatement){heliodeck.addStatement(currStatement,
isLoadOlder,fragment);setTimeout(function(){addCurrStatements(statements,isLoadOlder,fragment)},1E3)}else resolve(fragment)}})},removeStatements:function(uuidArray){for(var i=0;i<uuidArray.length;i++){var currNode=document.getElementById(uuidArray[i]);if(currNode)currNode.remove()}},makeApiCall:function(url,options,body){var defaultOptions={method:"GET",async:true,withCredentials:true,contentType:"application/json",timeout:1E4};options=options||{};options=Object.assign(defaultOptions,options);return new Promise(function(resolve,
reject){try{var xhr=new XMLHttpRequest;xhr.withCredentials=options.withCredentials;xhr.open(options.method,url,options.async);xhr.timeout=options.timeout;if(options.contentType)xhr.setRequestHeader("Content-Type",options.contentType);xhr.onload=function(){if(xhr.status===200)resolve(JSON.parse(xhr.responseText));else reject({status:"error",statusText:xhr.status+"-"+xhr.statusText})};xhr.onerror=function(){reject({status:"error",statusText:xhr.status+"-"+xhr.statusText})};xhr.ontimeout=function(){reject({status:"timeout",
statusText:xhr.status+"-"+xhr.statusText})};xhr.send(body)}catch(err){reject(err)}})}};window.heliodeck=heliodeck;if(wp_pb.StaticMethods.isPageHydrated())heliodeck.init();__e.push(["shamble",function(){heliodeck.init()}])})();