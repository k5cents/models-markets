var WpPwapi2=function(g){"use strict";var h=console||{log:function(){},error:function(){}},S="wpPwapi2.js",d={version000:"20180525.2",doPwapi:!0,doLocalStorage:!0,defaultCookieDomain:".washingtonpost.com",paywallTrackingCookie:"rplpwtrk",paywallTrackCookieExpire:function(){return(new Date).getTime()+31536e6},subscribeSubDomainIframeId:"pwapiCrsDmnLocStor_subscribe_iframe",subscribeSubDomainGetData:!1,cmdRequestGetStor:"cmdGetFromStorage",cmdRequestDeleteStor:"cmdDeleteFromStorage",cmdRequestSetStor:"cmdSetInStorage",cmdRequestGetAllStor:"cmdGetAllFromStorage",validOriginBaseDomains:["\\.washingtonpost\\.com","\\.digitalink\\.com"],validDocumentDomains:["washingtonpost.com","digitalink.com"],abTestReferrerOn:!0,abCookieName:"rplab",abRefPt:"http://pwapiptrf._pwapiptrf_.com",abTestExpire:function(){return(new Date).getTime()+864e7},abDebugCookie:"rplAbTestDebug"},f=function(e){var t,o,r,a=document.createElement("a"),i={};for(a.href=e,t=a.search.replace(/^\?/,"").split("&"),r=0;r<t.length;r++)i[(o=t[r].split("="))[0]]=o[1];return{protocol:a.protocol,host:a.host,hostname:a.hostname,port:a.port,pathname:a.pathname,search:a.search,searchObject:i,hash:a.hash}},c=[{id:"rplpwabt4",active:!0,getExpireMillis:function(){return(new Date).getTime()+864e7},results:[{id:"1",min:0,max:99}],transforms:{1:function(e,t){return t}}}],m=[{id:"rplabrfg",regex:/google.com$/i,results:[{id:"t1",min:0,max:9,act:!0,processPwapiResponse:function(e){return e},referrer:"http://pwapi.rplabrfgt1.com"},{id:"t2",min:10,max:19,act:!0,processPwapiResponse:function(e){if(!this.abObj||!this.pwapi)return h.error(S+" : abTestConfig rplabrfgoog t2 this.abObj or this.pwapi is blank"),e;if(!this.abObj.regex)return h.error(S+" : abTestConfig rplabrfgoog t2 abObj this.abObj.regex blank"),e;if(!this.pwapi.originalReferrer)return h.error(S+" : abTestConfig rplabrfgoog t2 abObj this.pwapi.originalReferrer blank"),e;var t=this.abObj.regex,o=this.pwapi.originalReferrer,r=f(o).hostname;return r&&(r=r.trim(),t.exec(r)&&(e.pwresp&&null!=e.pwresp.action&&null!=e.pwresp.url?(h.log(S+" : rplabrfg t2 orig act: "+e.pwresp.action+", url: "+e.pwresp.url),e.pwresp.action=0,e.pwresp.url="N/A",h.log(S+" : rplabrfg t2 transformed act: "+e.pwresp.action+", url: "+e.pwresp.url)):h.error(S+" : resData.pwresp blank"))),e},referrer:"http://pwapi.rplabrfgt2.com"},{id:"f",min:20,max:99,act:!1}]}],t=36e5,u=[{name:"cb_clicks",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"authdrredir",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"rplm2",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!1,toPwapi:!0},{name:"rplmct",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"rplsb",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!1,toPwapi:!1},{name:"rplrol",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"osfam",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"devicetype",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"de",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"client_region",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"X-WP-Split",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"rwebabt",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"wp_clicks",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"rpld1",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"rpld0",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"wapo_actmgmt",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"wpniuser",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"wapo_login_id",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"wpnisecure",expireOffsetMillis:t,cookiesToLocalStorage:!0,localStorageToCookies:!0,toPwapi:!0,raw:!0},{name:"WPPREF",expireOffsetMillis:t,cookiesToLocalStorage:!0,localStorageToCookies:!0,toPwapi:!0,raw:!0},{name:"wapo_secure_login_id",expireOffsetMillis:t,cookiesToLocalStorage:!0,localStorageToCookies:!0,toPwapi:!0,raw:!0},{name:"wapo_display",expireOffsetMillis:t,cookiesToLocalStorage:!0,localStorageToCookies:!0,toPwapi:!0,raw:!0},{name:"WPATC",expireOffsetMillis:t,cookiesToLocalStorage:!0,localStorageToCookies:!0,toPwapi:!0,raw:!0},{name:"wapo_groups",expireOffsetMillis:t,cookiesToLocalStorage:!0,localStorageToCookies:!0,toPwapi:!0,raw:!0}],b=function(e){try{if(!e)return!1;if("string"==typeof e||e instanceof String){for(var t=f(e),o=0;o<d.validOriginBaseDomains.length;o++)if(r=t.hostname,a=d.validOriginBaseDomains[o],r&&a&&null!=r.match(a+"$"))return!0}else h.error(S+": isOriginValid: origin is not a string: "+JSON.stringify(e))}catch(e){h.error(S+": isOriginValid unable to process: "+e.message,e)}var r,a;return!1},n=function(e,t,o){if(!(this instanceof n))return new n(e,t);if(!e){var r=S+": initLocStorApi: iframeId is blank/null";throw h.error(r),new Error(r)}if(!t){r=S+": initLocStorApi: callback is blank/null";throw h.error(r),new Error(r)}var a=document.getElementById(e);if(!a){r=S+": initLocStorApi: iframe id: "+e+", iframeElement is null";throw h.error(r),new Error(r)}var i=a.contentWindow;if(!i){r=S+": initLocStorApi: iframe id: "+e+", contentWindow is null";throw h.error(r),new Error(r)}if(!o){r=S+": initLocStorApi: targetOrigin is blank";throw h.error(r),new Error(r)}if(!b(o)){r=S+": initLocStorApi: targetOrigin is not valid";throw h.error(r),new Error(r)}this.targetOrigin=o,this.locStorApiIframeWindow=i,this.iframeEventListenerLocStorApiReference=this.locStorApiEventListener.bind({thiss:this,callback:t}),g.addEventListener("message",this.iframeEventListenerLocStorApiReference,!1)},w=function(e,t,o,r,a,i,n,s,l){if(!(this instanceof w))return new w(e,t,o,r,a,i,n,s,l);this.$jq=e,this.apiurl=t,this.cookieDomain=o,this.path=r,this.args=a,this.successCallback=i,this.errorCallback=n,this.doPwapi=s,this.doLocalStorage=l,this.timeoutMillis=15e3,o||(this.cookieDomain=d.defaultCookieDomain),a||(this.args={}),r||(this.path="/"),0!=this.path.indexOf("/")&&(this.path="/"+this.path),null==s&&(this.doPwapi=!0),null==l&&(this.doLocalStorage=!0)};w.prototype.setCallbacks=function(e,t){this.successCallback=e,this.errorCallback=t},w.prototype.storageAvailable=function(e){if(!e)return!1;try{var t=g[e],o="_wpPwapi1_js_stor_avail_";return t.setItem(o,o),t.removeItem(o),!0}catch(e){return!1}},w.prototype.allStorageAvailable=function(){var e=this.storageAvailable("localStorage"),t=this.storageAvailable("sessionStorage");return e&&t},w.prototype.getStorageData=function(t,o){if(null!=t&&null!=o&&this.allStorageAvailable()){for(var r=[],a=0;a<u.length;a++){var i=u[a],n=i.name;if(i.toPwapi&&n){var s=o.getItem(n);if(s){try{s=s.trim()}catch(e){h.error(S+" : getStorageData: unable to trim storageItemStr: "+s+", for key: "+n+" ::: "+e.message,e);continue}var l=null;try{var c=(l=JSON.parse(s)).e;if(o===localStorage&&c<(new Date).getTime()){r.push(n);continue}this.args[n]=l.v}catch(t){h.error(S+" : getStorageData: unable to json parse: "+s+", for key: "+n+" ::: "+e.message,t);continue}}}}for(a=0;a<r.length;a++)o.removeItem(r[a])}},w.prototype.getAllStorageData=function(){if(this.doLocalStorage&&d.doLocalStorage){if(!this.allStorageAvailable())return{};var e={};return this.getStorageData(e,localStorage),this.getStorageData(e,sessionStorage),e}h.log(S+" : getAllStorageData : Warning: not storing data: this.doLocalStorage: "+this.doLocalStorage+", config.doLocalStorage: "+d.doLocalStorage)},w.prototype.getFromLocalOrSessionStorage=function(e){if(!this.allStorageAvailable()||!e)return null;var t=localStorage.getItem(e);return null==t&&(t=sessionStorage.getItem(e)),t},w.prototype.storeDataLocalStorage=function(e,t,o){var r={};r.v=t,r.e=o;var a=JSON.stringify(r);0===o?sessionStorage.setItem(e,a):o<0||o<(new Date).getTime()?(sessionStorage.removeItem(e),localStorage.removeItem(e)):localStorage.setItem(e,a)},w.prototype.storDelete=function(e){this.doLocalStorage&&d.doLocalStorage?this.allStorageAvailable()&&e&&this.storeDataLocalStorage(e,"",-1):h.log(S+" : storDelete : Warning: not storing data: this.doLocalStorage: "+this.doLocalStorage+", config.doLocalStorage: "+d.doLocalStorage)},w.prototype.storeData=function(e){if(this.doLocalStorage&&d.doLocalStorage){if(this.allStorageAvailable()){if(!e)throw"storeData: response data is null/blank";var t=e.pwresp.locstor;if(t&&!(t.length<1))for(var o=0;o<t.length;o++){var r=t[o],a=r.k,i=r.v,n=r.e;null!=a&&null!=i&&null!=n&&("string"==typeof a&&"number"==typeof n?this.storeDataLocalStorage(a,i,n):h.error(S+" : k is not string, or ex is not number for: "+JSON.stringify(r)))}}}else h.log(S+" : storeData : Warning: not storing data: this.doLocalStorage: "+this.doLocalStorage+", config.doLocalStorage: "+d.doLocalStorage)},w.prototype.storeDataCookies=function(e,t,o,r){if(e){var a="",i="";o<0?a=";expires="+new Date(1e3).toUTCString:0<o&&(a=";expires="+new Date(o).toUTCString()),null!=this.cookieDomain&&(i=";domain="+this.cookieDomain),t||(t="");var n=e+"="+(r?t:encodeURIComponent(t))+";path=/"+a+i;document.cookie=n}},w.prototype.setCookieDomain=function(e){this.cookieDomain=e||d.defaultCookieDomain},w.prototype.deleteCookie=function(e){null!=e&&""!==(e=e.trim())&&this.storeDataCookies(e,"",1e3)},w.prototype.getCookie=function(e,t){if(!e)return null;if(!t&&void 0!==this.cookieCache)return this.cookieCache[e];if(!document.cookie)return null;for(var o={},r=null,a=document.cookie.split(";"),i=0;i<a.length;i++)if(0<a[i].indexOf("=")){var n=a[i].split("="),s=n[0],l=n[1];s&&(s=s.trim()),s===e&&(l||(l=""),r=l.trim()),o[s]=l.trim()}return this.cookieCache=o,r},w.prototype.deleteAllStorageAndCookies=function(){for(var e=0;e<u.length;e++){var t=u[e].name;this.deleteCookie(t),this.storDelete(t)}},w.prototype.synchCookiesAndLocalStorage=function(){if(this.doLocalStorage&&d.doLocalStorage){if(this.allStorageAvailable())for(var e=0;e<u.length;e++){var t=u[e];try{var o=t.name,r=t.raw,a=t.expireOffsetMillis,i=this.getCookie(o),n=localStorage.getItem(o),s=null;n&&(s=JSON.parse(n)).e<(new Date).getTime()&&(s=null,localStorage.removeItem(o));var l=null!=i,c=null!=s;if(l&&c)continue;if(l&&t.cookiesToLocalStorage){var p=(new Date).getTime()+a;this.storeDataLocalStorage(o,i,p)}else c&&t.localStorageToCookies&&this.storeDataCookies(o,s.v,s.e,r)}catch(e){h.error(S+" : Unable to synchCookiesAndLocalStorage for synchCookie item: "+JSON.stringify(t),e)}}}else h.log(S+" : synchCookiesAndLocalStorage : Warning: not storing data: this.doLocalStorage: "+this.doLocalStorage+", config.doLocalStorage: "+d.doLocalStorage)},w.prototype.procfn=function(e,t,o,r,a){if(e)try{r||a?e(r,a):e(o)}catch(e){h.error(S+" : "+t,e)}},w.prototype.setTimeout=function(e){e&&!isNaN(e)&&(this.timeoutMillis=e)},w.prototype.subDomainSubscribeLocStorCallback=function(e,t){t&&t.tag?this.locstorSubscribe?"myGetTag"===t.tag&&(h.log(S+": debug subDomainSubscribeLocStorCallback: callback myGetTag: "+JSON.stringify(t)),this.locstorSubscribe.close(),this.procInternal()):h.error(S+": subDomainSubscribeLocStorCallback: self.locstorSubscribe is null"):h.error(S+": subDomainSubscribeLocStorCallback: data or data.tag is null")},w.prototype.proc=function(){var e=this;if(d.subscribeSubDomainGetData){e.locstorSubscribe=null;try{if(e.locstorSubscribe=new n(d.subscribeSubDomainIframeId,e.subDomainSubscribeLocStorCallback.bind(e)),!e.locstorSubscribe)throw new Error("pwapi.proc: self.locstorSubscribe is null");var t={cmd:e.locstorSubscribe.cmdGet(),tag:"myGetTag",keys:["wapo_login_id","wpniUser"]};e.locstorSubscribe.proc(t)}catch(e){throw e}}else e.procInternal()},w.prototype.getAbCookie=function(){var e=this.getCookie(d.abCookieName);return e?JSON.parse(decodeURIComponent(e)):null},w.prototype.abTestResponseTemplate=function(){return{res:!1,abObj:null,result:null}},w.prototype.runGenericAbnTests=function(){for(var e=[],t=0;t<c.length;t++)try{var o=c[t];if(!o.id)continue;if(null==o.active||!o.active)continue;if(!o.getExpireMillis)continue;if(!o.results||o.results.length<1)continue;var r=this.getCookie(o.id);if(r){try{(l=o.transforms[r])&&e.push(l)}catch(e){}continue}var a=Math.floor(100*Math.random()),i=o.results;for(t=0;t<i.length;t++){var n=i[t];if(n&&null!=n.id&&null!=n.min&&null!=n.max&&(a>=n.min&&a<=n.max)){var s=null;if(s="function"==typeof n.id?n.id(this):n.id){this.storeDataCookies(o.id,s,o.getExpireMillis());try{var l;(l=o.transforms[s])&&e.push(l)}catch(e){}}break}}}catch(e){h.error(S+" :: runGenericAbnTests, unable to process idx: "+t,e)}return e},w.prototype.abTestReferrerInternal=function(e){var t=this;if(!e)return t.abTestResponseTemplate();if(!(e=e.trim()))return t.abTestResponseTemplate();var o=f(e).hostname;if(!o)return t.abTestResponseTemplate();o=o.trim();for(var r=null,a=null,i=0;i<m.length&&(a=null,!(a=(r=m[i]).regex.exec(o)));i++)r=null;if(!r||!a)return t.abTestResponseTemplate();var n=null;if(r.id&&(n=t.getCookie(r.id),(n="t2")&&r.results)){n=n.trim();for(i=0;i<r.results.length;i++){if((u=r.results[i]).id&&u.id.trim()===n)return(s=t.abTestResponseTemplate()).abObj=r,"boolean"==typeof(s.result=u).act?s.res=u.act:"function"==typeof u.act&&(s.res=u.act()),s}}n=null;var s,l=Math.floor(100*Math.random()),c=r.results,p=!1,g=!1,u=null;if(!c||c.length<1)return t.abTestResponseTemplate();for(i=0;i<c.length;i++)if(l>=(u=c[i]).min&&l<=u.max){p=!0,"boolean"==typeof u.act?g=u.act:"function"==typeof u.act&&(g=u.act());break}return p?(u&&u.id&&r.id&&(n||(n=u.id),n&&t.storeDataCookies(r.id,n.trim(),d.abTestExpire())),(s=t.abTestResponseTemplate()).abObj=r,s.result=u,s.res=g,s):t.abTestResponseTemplate()},w.prototype.abTestReferrer=function(e){try{var t=this.getCookie("devicetype"),o=!1;null!=t&&"0"==t&&(o=!0);var r=this.getCookie(d.abDebugCookie);if(d.abTestReferrerOn&&o||r){var a=this.abTestReferrerInternal(e);if(a)return a}}catch(e){h.error(S+" :: unable to abTestReferrerInternal: "+e.message,e)}return this.abTestResponseTemplate()},w.prototype.getContentSection=function(){try{var e=g.wp_section;return e||(e=g.TWP.Data.Tracking.props.section),e?""==(e=e.trim())?null:e:null}catch(e){return null}},w.prototype.getContentTags=function(){try{var e=g.wp_meta_data.tags_for_paywall;return e?""==(e=e.trim())?null:e:null}catch(e){return null}},w.prototype.trackPaywallHits=function(e){if(e)try{if(3==e.pwresp.action||5==e.pwresp.action){var t=(new Date).getMonth()+1,o=(new Date).getTime(),r=this.getCookie(d.paywallTrackingCookie);(r=r?JSON.parse(decodeURIComponent(r)):{})[t]=o,this.storeDataCookies(d.paywallTrackingCookie,JSON.stringify(r),d.paywallTrackCookieExpire())}}catch(e){h.error(S+" : unable to pwapi trackPaywallHits: "+e.message,e)}},w.prototype.didUserHitPaywallSince=function(e){try{if(!e)return!1;var t=this.getCookie(d.paywallTrackingCookie);if(!t)return!1;t=JSON.parse(decodeURIComponent(t));var o=(new Date).getMonth();0==o&&(o=12);var r=t[o];if(null==r)return!1;if((new Date).getTime()-e<r)return!0}catch(e){h.error(S+" : Unable to didUserHitPaywallSince: "+e.message,e)}return!1},w.prototype.procInternal=function(){var a=this;if(this.doPwapi&&d.doPwapi){if(!a.apiurl){var e=S+": apiurl is null";throw h.error(e),new Error(e)}if(!b(a.apiurl)){e=S+": apiurl invalid";throw h.error(e),new Error(e)}a.args.referrer||(a.args.referrer=""),a.args.referrer=a.args.referrer.trim(),a.originalReferrer=a.args.referrer;var i=a.runGenericAbnTests(),t=a.getContentSection();t&&(a.args.pwapi_contentsection=t),function(e){if(!e)return!1;try{var t=e.getFromLocalOrSessionStorage("newsletter_history");if(!t)return!1;var o=JSON.parse(t);if(!o)return!1;var r=!0;for(var a in o)if(o.hasOwnProperty(a)){r=!1;break}if(!r)return!0}catch(e){h.error(S+" : unable to get nlHistory : "+e.message,e)}return!1}(a)&&(a.args.pwapi_is_nl_user="1");var o=a.getContentTags();o&&(a.args.pwapi_ct_tags=o);try{a.didUserHitPaywallSince(6048e6)&&(a.args.pwapi_usr_ht_pw="1")}catch(e){h.error(S+" : Unable to check didUserHitPaywallSince in procInternal for setting pwapi_usr_ht_pw query param arg: "+e.message,e)}a.getAllStorageData();try{a.synchCookiesAndLocalStorage()}catch(e){h.error(S+" :: unable to synchCookiesAndLocalStorage: "+e.message,e)}var r="pwapi"+Math.random().toString().substr(2);g[r]=function(t){clearTimeout(p),g.pwapiResponse=(new Date).getTime()-g.pwapiStart;try{a.storeData(t)}catch(e){h.error(S+" : Unable to local storage: "+e.message,t)}var e=t;try{if(i)for(var o=0;o<i.length;o++)try{var r=i[o];r&&(e=r(a,e))}catch(e){h.log(S+" : unable to run single transform function for generic ab tests: "+e.message,e)}}catch(e){h.error(S+" : unable run transform functions for generic ab test: "+e.message,e)}a.trackPaywallHits(e),a.procfn(a.successCallback,"successCallback",e,null,null)},g.pwapiStart=(new Date).getTime();var n,s=document.createElement("script"),l=(-1===this.path.indexOf("?")?"?":"&")+"callback="+r,c="&";for(n in this.args)c+=n+"="+encodeURIComponent(this.args[n])+"&";s.src=a.apiurl+this.path+l+c,document.getElementsByTagName("head")[0].appendChild(s);var p=setTimeout(function(){console.error("PWAPI ERROR/TIMEOUT"),a.procfn(a.errorCallback,"errorCallback",null,null,"Pwapi timeout")},a.timeoutMillis)}else h.log(S+" : Warning: not calling pwapi: this.doPwapi: "+this.doPwapi+", config.pwapi: "+d.doPwapi)},n.prototype.proc=function(e){if(!e)return h.error(S+": locStorApiCall: cmdObj is blank/null"),!1;if(!this.locStorApiIframeWindow){var t=S+": locStorApiCall: locStorApiIframeWindow is blank/null";throw h.error(t),new Error(t)}this.locStorApiIframeWindow.postMessage(JSON.stringify(e),this.targetOrigin)},n.prototype.locStorApiEventListener=function(t){if(t&&t.origin){if(!b(t.origin))return h.error(S+": locStorApiEventListener: event origin is not valid"),void h.error(t.origin);try{this.callback(this.thiss,JSON.parse(t.data))}catch(e){h.error(S+": locStorApiEventListener: uable to call callback function with data: "+t.data+" :: err.message: "+e.message,e)}}else h.error(S+": locStorApiEventListener: ev or ev.origin is blank")},n.prototype.cmdGet=function(){return d.cmdRequestGetStor},n.prototype.cmdGetAll=function(){return d.cmdRequestGetAllStor},n.prototype.cmdDelete=function(){return d.cmdRequestDeleteStor},n.prototype.cmdSet=function(){return d.cmdRequestSetStor},n.prototype.close=function(){this.iframeEventListenerLocStorApiReference&&g.removeEventListener("message",this.iframeEventListenerLocStorApiReference,!1)};var o=g.location.href,r=f(g.location.href),k=null;try{var a=!1;if(r&&r.searchObject){var i=r.searchObject,s=i.pwapisetddmn;if(s&&"1"===s){var l=i.pwapiddmn;l&&function(t){if(!t)return!1;try{for(var e=0;e<d.validDocumentDomains.length;e++)if(t===d.validDocumentDomains[e])return!0}catch(e){h.error(S+": isDocumentDomainValid: Unable to determine for dd: "+t,e)}return!1}(l)&&(document.domain=l,a=!0),a&&(a=!(!(k=i.targetorigin)||!b(k)))}}var v=null;if(a){try{v=g.parent}catch(e){}g.addEventListener("message",function(t){try{if(!t)return;if(!b(t.origin))return;var e=t.data;if(!e)return;var o=new w;if(!o.allStorageAvailable())return void h.log(S+": Warn local/session storage not available");var r=JSON.parse(e),a=r.cmd;if(!a)return;var i={cmd:a};if(r.tag&&(i.tag=r.tag),a===d.cmdRequestGetStor){if(i.stor={},l=r.keys)for(var n=0;n<l.length;n++){var s=o.getFromLocalOrSessionStorage(l[n]);i.stor[l[n]]=s}}else if(a===d.cmdRequestDeleteStor){var l;if(l=r.keys)for(n=0;n<l.length;n++)o.storDelete(l[n]);i=r}else if(a===d.cmdRequestSetStor){var c=r.stor,p=(r.type,localStorage);if(c)for(var g in c)c.hasOwnProperty(g)&&p.setItem(g,c[g]);i=r}else if(a===d.cmdRequestGetAllStor){i.local={},i.session={};var u=localStorage.length,f=sessionStorage.length;for(n=0;n<u;n++){var m=localStorage.key(n);s=localStorage.getItem(m);i.local[m]=s}for(n=0;n<f;n++){m=sessionStorage.key(n),s=sessionStorage.getItem(m);i.session[m]=s}}v&&k?v.postMessage(JSON.stringify(i),k):h.error(S+": parentWindow is null or targetOrigin is blank")}catch(e){h.error(S+": iframe message event listener unable to respond: e.origin: "+t.origin+", e.data: "+t.data+" :: err.message: "+e.message,e)}},!1)}}catch(e){h.error(S+": Unable to set document domain based on url: "+o+", err :: "+e.message,e)}return{pwapi:w,locstor:n}}(this),wpPwapi=function(e){var o=null,t=-1===(e.document.location.hostname||"subscribe.digitalink.com").indexOf("pb-dev."),r=t?"https://pwapi.washingtonpost.com":"https://testpwapi.digitalink.com",a=t?".washingtonpost.com":".digitalink.com",i={referrer:document.referrer},n=e.location.pathname+e.location.search,s=null;var l=new WpPwapi2.pwapi(null,r,a,n,i,function(e){"function"==typeof callbackSuccessFunction?callbackSuccessFunction(e):s=e},function(e,t){"function"==typeof o?o(e,t):responseError={errTextStatusStr:e,errThrownStr:t}});l.registerSucccessCallback=function(e){callbackSuccessFunction=e,"object"==typeof s&&callbackSuccessFunction(s)},l.registerErrorCallback=function(e){o=e,"object"==typeof responseError&&o(e)};try{l.proc()}catch(e){console.error("Unable to call pwapi: err message: "+e.message,e)}return l}(this),WpPwapi1=function(e,c){return{pwapi:function(e,t,o,r,a,i,n,s,l){return c.registerSucccessCallback(i),c.registerErrorCallback(n),{proc:function(){}}},locstor:e.WpPwapi2.locstor}}(this,wpPwapi);
